import{r as t,c as i,h as s,H as e,g as o}from"./p-df2f1668.js";function h(){return!![...arguments].some((t=>void 0!==t))}const n=class{constructor(s){t(this,s),this.streamactive=i(this,"streamactive",7),this.streaminactive=i(this,"streaminactive",7),this.frameupdate=i(this,"frameupdate",7),this.streaminiterror=i(this,"streaminiterror",7),this.lastTime=-1,this.videoDeviceId=void 0,this.audioDeviceId=void 0,this.video=!0,this.width=void 0,this.height=void 0,this.videoFacingMode=void 0,this.resizeMode=void 0,this.aspectRatio=void 0,this.audio=!1,this.sampleRate=void 0,this.sampleSize=void 0,this.echoCancellation=void 0,this.autoGainControl=void 0,this.noiseSuppression=void 0,this.latency=void 0,this.channelCount=void 0,this.frameRate=void 0,this.brightness=void 0,this.colorTemperature=void 0,this.contrast=void 0,this.exposureCompensation=void 0,this.exposureMode=void 0,this.exposureTime=void 0,this.focusDistance=void 0,this.focusMode=void 0,this.iso=void 0,this.pan=void 0,this.pointsOfInterest=void 0,this.saturation=void 0,this.sharpness=void 0,this.tilt=void 0,this.torch=void 0,this.whiteBalanceMode=void 0,this.zoom=void 0,this.controls=!1,this.muted=!0,this.volume=1,this.autoplay=!0,this.playsinline=!0,this.stream=void 0,this.streamState="inactive"}getVideoElement(){return new Promise((()=>{}))}setVolume(){this.videoElement.volume=this.volume}componentDidLoad(){this.videoElement=this.el.shadowRoot.querySelector("video"),this.videoElement.addEventListener("playing",(()=>{this.setStreamState("active")})),this.initStream()}onFrame(){"active"===this.streamState&&requestAnimationFrame(this.onFrame.bind(this));var t=this.videoElement.currentTime;t!==this.lastTime&&(this.lastTime=t,this.frameupdate.emit(t))}async reInit(){this.initStream()}updateVideoConstraints(t,i,s){console.log("updateVideoConstraints",arguments),this.applyConstraints({advanced:[{[s]:t}]},"video")}getTrack(t="video",i=0){if(!this.stream||!this.stream.active)throw new Error("stream is not active");let s;if("video"===t?s=this.stream.getVideoTracks()[i]:"audio"===t&&(s=this.stream.getAudioTracks()[i]),!s)throw new Error(`Can't get ${t} track from the current stream`);return s}async initStream(){this.setStreamState("inactive");try{const t=await this.createConstraints();this.stream=await navigator.mediaDevices.getUserMedia(t),this.videoElement.srcObject=this.stream}catch(t){this.streaminiterror.emit(t)}}setStreamState(t){this.streamState=t,"active"===t?(this.streamactive.emit(),this.onFrame()):this.streaminactive.emit()}async createConstraints(){let t={audio:this.audio,video:this.video};if(this.video&&h(this.width,this.height,this.videoFacingMode,this.videoDeviceId)){t.video={},this.videoDeviceId&&(t.video.deviceId=this.videoDeviceId),this.width&&(t.video.width={ideal:this.width}),this.height&&(t.video.height={ideal:this.height}),this.videoFacingMode&&(t.video.facingMode=this.videoFacingMode),this.resizeMode&&(t.video.resizeMode=this.resizeMode);const i=t.video.advanced=[];void 0!==this.brightness&&i.push({brightness:this.brightness}),void 0!==this.colorTemperature&&i.push({colorTemperature:this.colorTemperature}),void 0!==this.contrast&&i.push({contrast:this.contrast}),void 0!==this.exposureCompensation&&i.push({exposureCompensation:this.exposureCompensation}),void 0!==this.exposureMode&&i.push({exposureMode:this.exposureMode}),void 0!==this.exposureTime&&i.push({exposureTime:this.exposureTime}),void 0!==this.focusDistance&&i.push({focusDistance:this.focusDistance}),void 0!==this.focusMode&&i.push({focusMode:this.focusMode}),void 0!==this.iso&&i.push({iso:this.iso}),void 0!==this.pan&&i.push({pan:this.pan}),void 0!==this.pointsOfInterest&&i.push({pointsOfInterest:this.pointsOfInterest}),void 0!==this.saturation&&i.push({saturation:this.saturation}),void 0!==this.sharpness&&i.push({sharpness:this.sharpness}),void 0!==this.tilt&&i.push({tilt:this.tilt}),void 0!==this.torch&&i.push({torch:this.torch}),void 0!==this.whiteBalanceMode&&i.push({whiteBalanceMode:this.whiteBalanceMode}),void 0!==this.zoom&&i.push({zoom:this.zoom}),void 0!==this.frameRate&&i.push({frameRate:this.frameRate})}return this.audio&&h(this.sampleRate,this.sampleSize,this.echoCancellation,this.autoGainControl,this.noiseSuppression,this.latency,this.channelCount)&&(t.audio={},this.audioDeviceId&&(t.audio.deviceId=this.audioDeviceId),this.sampleRate&&(t.audio.sampleRate=this.sampleRate),this.sampleSize&&(t.audio.sampleSize=this.sampleSize),void 0!==this.echoCancellation&&(t.audio.echoCancellation=this.echoCancellation),void 0!==this.autoGainControl&&(t.audio.autoGainControl=this.autoGainControl),void 0!==this.noiseSuppression&&(t.audio.noiseSuppression=this.noiseSuppression),void 0!==this.latency&&(t.audio.latency=this.latency),this.channelCount&&(t.audio.channelCount=this.channelCount)),t}async applyConstraints(t,i="video",s=0){return new Promise(((e,o)=>{try{this.getTrack(i,s).applyConstraints(t),e()}catch(t){o(t),console.error(t)}}))}async getConstraints(t="video",i=0){return new Promise(((s,e)=>{try{this.getTrack(t,i).getConstraints(),s()}catch(t){e(t),console.error(t)}}))}async getCapabilities(t="video",i=0){return new Promise(((s,e)=>{try{s(this.getTrack(t,i).getCapabilities())}catch(t){e(t)}}))}async getTrackSettings(t="video",i=0){return new Promise(((s,e)=>{try{s(this.getTrack(t,i).getSettings())}catch(t){e(t)}}))}async stopStream(){this.stream.getTracks().forEach((t=>t.stop())),this.setStreamState("inactive")}async getMediaDevices(t){if(-1===["videoinput","audioinput","audiooutput"].indexOf(t))return Promise.reject(new Error("kind must be videoinput, audioinput, or audiooutput"));const i=await navigator.mediaDevices.enumerateDevices();return t?i.filter((i=>i.kind===t)):i}async getSupportedConstraints(){return Promise.resolve(navigator.mediaDevices.getSupportedConstraints())}async viewDocumentation(){await window.open("https://github.com/The-AR-Company/user-media-component/blob/master/user-media/src/components/user-media/readme.md","_blank")}render(){return s(e,null,s("slot",null),s("video",{ref:t=>this.videoElement=t,controls:this.controls,muted:this.muted,autoplay:this.autoplay,playsinline:this.playsinline}))}get el(){return o(this)}static get watchers(){return{volume:["setVolume"],video:["reInit"],videoDeviceId:["reInit"],videoFacingMode:["reInit"],aspectRatio:["reInit"],resizeMode:["reInit"],audio:["reInit"],audioDeviceId:["reInit"],sampleRate:["reInit"],sampleSize:["reInit"],echoCancellation:["reInit"],autoGainControl:["reInit"],noiseSuppression:["reInit"],channelCount:["reInit"],latency:["reInit"],width:["updateVideoConstraints"],height:["updateVideoConstraints"],frameRate:["updateVideoConstraints"],brightness:["updateVideoConstraints"],colorTemperature:["updateVideoConstraints"],contrast:["updateVideoConstraints"],exposureCompensation:["updateVideoConstraints"],exposureMode:["updateVideoConstraints"],exposureTime:["updateVideoConstraints"],focusDistance:["updateVideoConstraints"],focusMode:["updateVideoConstraints"],iso:["updateVideoConstraints"],pan:["updateVideoConstraints"],pointsOfInterest:["updateVideoConstraints"],saturation:["updateVideoConstraints"],sharpness:["updateVideoConstraints"],tilt:["updateVideoConstraints"],torch:["updateVideoConstraints"],whiteBalanceMode:["updateVideoConstraints"],zoom:["updateVideoConstraints"]}}};n.style=":host{display:block}video{width:100%;height:100%;object-fit:contain}";export{n as user_media}